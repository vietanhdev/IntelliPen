<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IntelliPen Text Field Detection Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .test-section {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #495057;
        }
        
        input, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
            font-family: inherit;
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .contenteditable {
            border: 1px solid #ced4da;
            border-radius: 4px;
            padding: 10px;
            min-height: 80px;
            background: white;
        }
        
        .instructions {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .test-text {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 13px;
        }
        
        .status-info {
            background: #e2e3e5;
            border: 1px solid #d6d8db;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        .dynamic-content {
            border: 2px dashed #6c757d;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üñãÔ∏è IntelliPen Text Field Detection Test</h1>
        <p>Test page for debugging text field detection and suggestion system</p>
    </div>

    <div class="instructions">
        <h3>üìã Instructions</h3>
        <ol>
            <li><strong>Load the fix script:</strong> Click "Load Enhanced Integration" below</li>
            <li><strong>Check status:</strong> Look for the IntelliPen status panel in the top-right corner</li>
            <li><strong>Test fields:</strong> Click in any text field below and start typing</li>
            <li><strong>Generate suggestions:</strong> Use the "üß™ Test" button in the status panel</li>
            <li><strong>View suggestions:</strong> Press <kbd>Ctrl+Shift+I</kbd> to open the suggestion menu</li>
        </ol>
    </div>

    <div class="status-info">
        <h3>üîç What to Look For</h3>
        <ul>
            <li><strong>Status Panel:</strong> Should appear in top-right corner showing "Active Fields" count</li>
            <li><strong>Field Indicators:</strong> üñãÔ∏è icon should appear in text fields when focused</li>
            <li><strong>Field Highlighting:</strong> Blue outline when fields are focused</li>
            <li><strong>Suggestions:</strong> Yellow highlights and tooltips for text issues</li>
        </ul>
    </div>

    <button onclick="loadEnhancedIntegration()" style="background: #28a745; font-size: 16px; padding: 15px 30px;">
        üöÄ Load Enhanced Integration
    </button>
    
    <button onclick="testAllFields()" style="background: #ffc107; color: #212529;">
        üß™ Test All Fields
    </button>
    
    <button onclick="addDynamicField()" style="background: #17a2b8;">
        ‚ûï Add Dynamic Field
    </button>

    <div class="test-section">
        <h3>üìù Basic Text Fields</h3>
        
        <div class="form-group">
            <label for="email-field">Email Address</label>
            <input type="email" id="email-field" placeholder="Enter your email address">
        </div>
        
        <div class="form-group">
            <label for="text-field">General Text</label>
            <input type="text" id="text-field" placeholder="Type some text here">
        </div>
        
        <div class="form-group">
            <label for="search-field">Search</label>
            <input type="search" id="search-field" placeholder="Search for something">
        </div>
    </div>

    <div class="test-section">
        <h3>üìÑ Text Areas</h3>
        
        <div class="form-group">
            <label for="comment-area">Comment</label>
            <textarea id="comment-area" placeholder="Write a comment here..."></textarea>
        </div>
        
        <div class="form-group">
            <label for="message-area">Message</label>
            <textarea id="message-area" placeholder="Type your message..."></textarea>
        </div>
    </div>

    <div class="test-section">
        <h3>‚úèÔ∏è Content Editable</h3>
        
        <div class="form-group">
            <label>Rich Text Editor</label>
            <div class="contenteditable" contenteditable="true" data-placeholder="Start typing here...">
                Click here to edit this text. You can format it however you like.
            </div>
        </div>
        
        <div class="form-group">
            <label>Simple Editable</label>
            <div class="contenteditable" contenteditable="true" style="min-height: 60px;">
                Another editable area for testing.
            </div>
        </div>
    </div>

    <div class="test-section">
        <h3>üß™ Test Text Samples</h3>
        <p>Copy and paste these text samples into the fields above to test suggestion generation:</p>
        
        <div class="test-text">
            <strong>Grammar Errors:</strong><br>
            This is a test sentance with some erors. I recieve alot of feedback about teh quality of my writing.
        </div>
        
        <div class="test-text">
            <strong>Style Improvements:</strong><br>
            The meeting was very good and very important. We had a very productive discussion about very significant issues.
        </div>
        
        <div class="test-text">
            <strong>Formal Tone:</strong><br>
            Hey there! I can't make it to the meeting cuz I'm super busy. Let's catch up later, ok?
        </div>
    </div>

    <div class="test-section">
        <h3>üîÑ Dynamic Content</h3>
        <div id="dynamic-container" class="dynamic-content">
            <p>Dynamic fields will be added here...</p>
        </div>
    </div>

    <div class="test-section">
        <h3>üìä Debug Information</h3>
        <button onclick="showDebugInfo()">Show Debug Info</button>
        <button onclick="clearConsole()">Clear Console</button>
        <pre id="debug-output" style="background: #f8f9fa; padding: 15px; border-radius: 4px; margin-top: 10px; display: none;"></pre>
    </div>

    <script>
        let fieldCounter = 0;
        
        function loadEnhancedIntegration() {
            console.log('üöÄ Loading Enhanced IntelliPen Integration...');
            
            // Load the fix script
            const script = document.createElement('script');
            script.src = 'fix-text-field-detection.js';
            script.onload = () => {
                console.log('‚úÖ Enhanced integration loaded successfully!');
                setTimeout(() => {
                    showStatus();
                }, 1000);
            };
            script.onerror = () => {
                console.error('‚ùå Failed to load enhanced integration script');
                alert('Failed to load the enhanced integration script. Make sure fix-text-field-detection.js is in the same directory.');
            };
            
            document.head.appendChild(script);
        }
        
        function testAllFields() {
            console.log('üß™ Testing all fields...');
            
            // Add test text to all fields
            const testTexts = [
                'This is a test sentance with erors.',
                'I recieve alot of feedback about teh quality.',
                'The meeting was very good and very important.',
                'Hey there! I can\'t make it cuz I\'m busy.'
            ];
            
            const fields = document.querySelectorAll('input[type="text"], input[type="email"], input[type="search"], textarea, [contenteditable="true"]');
            
            fields.forEach((field, index) => {
                const testText = testTexts[index % testTexts.length];
                
                if (field.contentEditable === 'true') {
                    field.textContent = testText;
                    field.dispatchEvent(new Event('input', { bubbles: true }));
                } else {
                    field.value = testText;
                    field.dispatchEvent(new Event('input', { bubbles: true }));
                }
                
                // Focus each field briefly to trigger detection
                setTimeout(() => {
                    field.focus();
                    setTimeout(() => field.blur(), 200);
                }, index * 300);
            });
            
            console.log(`üìù Added test text to ${fields.length} fields`);
        }
        
        function addDynamicField() {
            fieldCounter++;
            const container = document.getElementById('dynamic-container');
            
            const fieldDiv = document.createElement('div');
            fieldDiv.className = 'form-group';
            fieldDiv.innerHTML = `
                <label for="dynamic-field-${fieldCounter}">Dynamic Field ${fieldCounter}</label>
                <input type="text" id="dynamic-field-${fieldCounter}" placeholder="This field was added dynamically">
            `;
            
            container.appendChild(fieldDiv);
            console.log(`‚ûï Added dynamic field ${fieldCounter}`);
            
            // Trigger a scan if integration is loaded
            if (window.intelliPenIntegration) {
                setTimeout(() => {
                    window.intelliPenIntegration.scanForTextFields();
                }, 100);
            }
        }
        
        function showDebugInfo() {
            const debugOutput = document.getElementById('debug-output');
            
            const info = {
                timestamp: new Date().toISOString(),
                integration: !!window.intelliPenIntegration,
                activeFields: window.intelliPenIntegration?.stats?.activeFields || 0,
                totalSuggestions: window.intelliPenIntegration?.stats?.totalSuggestions || 0,
                textFields: document.querySelectorAll('input[type="text"], input[type="email"], input[type="search"], textarea, [contenteditable="true"]').length,
                userAgent: navigator.userAgent,
                url: window.location.href
            };
            
            debugOutput.textContent = JSON.stringify(info, null, 2);
            debugOutput.style.display = 'block';
            
            console.log('üîç Debug Info:', info);
        }
        
        function clearConsole() {
            console.clear();
            console.log('üßπ Console cleared');
        }
        
        function showStatus() {
            if (window.intelliPenIntegration) {
                console.log('‚úÖ IntelliPen Integration Status:', {
                    initialized: window.intelliPenIntegration.isInitialized,
                    activeFields: window.intelliPenIntegration.stats.activeFields,
                    totalSuggestions: window.intelliPenIntegration.stats.totalSuggestions
                });
            } else {
                console.log('‚ùå IntelliPen Integration not loaded');
            }
        }
        
        // Add some interactivity to contenteditable elements
        document.addEventListener('DOMContentLoaded', () => {
            const editables = document.querySelectorAll('[contenteditable="true"]');
            editables.forEach(editable => {
                editable.addEventListener('focus', () => {
                    if (editable.textContent.trim() === '' || editable.textContent === editable.dataset.placeholder) {
                        editable.textContent = '';
                    }
                });
                
                editable.addEventListener('blur', () => {
                    if (editable.textContent.trim() === '') {
                        editable.textContent = editable.dataset.placeholder || '';
                    }
                });
            });
        });
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.shiftKey) {
                switch (e.key) {
                    case 'L':
                        e.preventDefault();
                        loadEnhancedIntegration();
                        break;
                    case 'T':
                        e.preventDefault();
                        testAllFields();
                        break;
                    case 'D':
                        e.preventDefault();
                        showDebugInfo();
                        break;
                }
            }
        });
        
        console.log('üñãÔ∏è IntelliPen Test Page Ready!');
        console.log('üí° Keyboard shortcuts:');
        console.log('   Ctrl+Shift+L: Load Enhanced Integration');
        console.log('   Ctrl+Shift+T: Test All Fields');
        console.log('   Ctrl+Shift+D: Show Debug Info');
        console.log('   Ctrl+Shift+I: Open Suggestion Menu (after loading integration)');
    </script>
</body>
</html>