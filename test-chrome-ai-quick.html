<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick Chrome AI Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .available { background: #d4edda; color: #155724; }
        .unavailable { background: #f8d7da; color: #721c24; }
        .downloadable { background: #fff3cd; color: #856404; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .result {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>üöÄ Quick Chrome AI Test</h1>
    
    <div id="status"></div>
    
    <button onclick="checkAPIs()">Check APIs</button>
    <button onclick="testPrompt()">Test Prompt API</button>
    <button onclick="testSummarizer()">Test Summarizer</button>
    <button onclick="runFixScript()">Run Fix Script</button>
    
    <div id="results"></div>

    <script>
        async function checkAPIs() {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = '<h3>API Status:</h3>';
            
            const apis = [
                { name: 'Prompt API', obj: window.ai?.languageModel },
                { name: 'Summarizer API', obj: window.ai?.summarizer },
                { name: 'Writer API', obj: window.ai?.writer },
                { name: 'Rewriter API', obj: window.ai?.rewriter },
                { name: 'Proofreader API', obj: window.ai?.proofreader },
                { name: 'Translator API', obj: window.ai?.translator }
            ];
            
            for (const api of apis) {
                const div = document.createElement('div');
                div.className = 'status';
                
                if (!api.obj) {
                    div.className += ' unavailable';
                    div.textContent = `${api.name}: Not Available`;
                } else if (typeof api.obj.availability === 'function') {
                    try {
                        const availability = await api.obj.availability();
                        div.className += availability === 'available' ? ' available' : 
                                        availability === 'downloadable' ? ' downloadable' : ' unavailable';
                        div.textContent = `${api.name}: ${availability}`;
                    } catch (error) {
                        div.className += ' unavailable';
                        div.textContent = `${api.name}: Error - ${error.message}`;
                    }
                } else {
                    div.className += ' available';
                    div.textContent = `${api.name}: Available (no availability check)`;
                }
                
                statusDiv.appendChild(div);
            }
        }
        
        async function testPrompt() {
            const resultsDiv = document.getElementById('results');
            
            try {
                if (!window.ai?.languageModel) {
                    throw new Error('Prompt API not available');
                }
                
                resultsDiv.innerHTML += '<div class="result">Creating Prompt API session...</div>';
                
                const session = await window.ai.languageModel.create({
                    outputLanguage: 'en',
                    monitor: (m) => {
                        m.addEventListener('downloadprogress', (e) => {
                            resultsDiv.innerHTML += `<div class="result">Download progress: ${Math.round(e.loaded * 100)}%</div>`;
                        });
                    }
                });
                
                resultsDiv.innerHTML += '<div class="result">Sending prompt...</div>';
                const result = await session.prompt('Say hello and tell me you are working correctly');
                
                resultsDiv.innerHTML += `<div class="result">‚úÖ Prompt API Result:\n${result}</div>`;
                
                session.destroy();
            } catch (error) {
                resultsDiv.innerHTML += `<div class="result">‚ùå Prompt API Error: ${error.message}</div>`;
            }
        }
        
        async function testSummarizer() {
            const resultsDiv = document.getElementById('results');
            
            try {
                if (!window.ai?.summarizer) {
                    throw new Error('Summarizer API not available');
                }
                
                resultsDiv.innerHTML += '<div class="result">Creating Summarizer session...</div>';
                
                const session = await window.ai.summarizer.create({
                    monitor: (m) => {
                        m.addEventListener('downloadprogress', (e) => {
                            resultsDiv.innerHTML += `<div class="result">Download progress: ${Math.round(e.loaded * 100)}%</div>`;
                        });
                    }
                });
                
                const longText = `
                Chrome's built-in AI APIs represent a significant advancement in web technology, bringing powerful artificial intelligence capabilities directly to the browser. These APIs include the Prompt API for general language model interactions, the Summarizer API for content summarization, the Writer API for content generation, the Rewriter API for text modification, the Proofreader API for grammar checking, and the Translator API for language translation. All of these APIs leverage Google's Gemini Nano model, which runs locally on the user's device, ensuring privacy and reducing latency. The local processing approach means that user data never leaves their device, addressing privacy concerns while providing fast, responsive AI-powered features. However, these APIs have specific hardware requirements, including Chrome 138+, significant storage space for the AI model, and adequate GPU resources for processing.
                `;
                
                resultsDiv.innerHTML += '<div class="result">Summarizing text...</div>';
                const result = await session.summarize(longText);
                
                resultsDiv.innerHTML += `<div class="result">‚úÖ Summarizer Result:\n${result}</div>`;
                
                session.destroy();
            } catch (error) {
                resultsDiv.innerHTML += `<div class="result">‚ùå Summarizer Error: ${error.message}</div>`;
            }
        }
        
        function runFixScript() {
            // Load and run the fix script
            const script = document.createElement('script');
            script.src = 'fix-chrome-ai-apis.js';
            document.head.appendChild(script);
        }
        
        // Auto-check on load
        window.addEventListener('load', checkAPIs);
    </script>
</body>
</html>